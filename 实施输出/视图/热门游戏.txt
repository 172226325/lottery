create view v_hot_game as
select 
game.*,
(
select 
sum(rule.issue_count)
from issue_setting setting
left join issue_generate_rule rule
on setting.id = rule.issue_setting_id
where setting.game_id = game.id
) issue_count,
(select issue.issue_num from issue issue where 
issue.start_time <= NOW()
and issue.end_time > NOW()
and issue.game_code = game.game_code
) current_issue,
(select issue.issue_num_inner from issue issue where 
issue.start_time <= NOW()
and issue.end_time > NOW()
and issue.game_code = game.game_code
) current_issue_inner
from game game
left join 
(select 
game_code,order_num
from(
SELECT 
bo.game_code, count(1) order_num
FROM betting_order bo
where bo.betting_time >= DATE_SUB(NOW(),INTERVAL 5 DAY)
GROUP BY bo.game_code) tmp
order by order_num desc) b
on game.game_code = b.game_code
order by b.order_num desc


